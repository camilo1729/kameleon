slurm_install:
 - create_munge_key:
   - exec_chroot: /usr/sbin/create-munge-key
 - slurm_install_from_http:
   - exec_chroot: bash -c "cd /root/ ; wget $$slurm_repository/$$slurm_version.tar.bz2"
   - exec_chroot: bash -c "cd /root/ ; tar xvjf $$slurm_version.tar.bz2 -C ."
   - exec_chroot: bash -c "cd /root/ ; ln -s $$slurm_version slurm"
 - slurm_install_from_git:
   - exec_chroot: bash -c "cd /root/ ; git clone $$slurm_git_repository"
 - slurm_config:
   - exec_chroot: bash -c "cd /root/slurm/ ; ./configure --enable-multiple-slurmd"
   - exec_chroot: bash -c "cd /root/slurm/ ; make"
   - exec_chroot: bash -c "cd /root/slurm/ ; make install"
   - exec_chroot: mkdir /home/slurm
   - exec_chroot: useradd slurm
   - exec_chroot: usermod -p \$1\$KkIWr.cK\$cue3GT8UYBVfEVIvMCBLF0 slurm
   - exec_chroot: bash -c "cd /etc ; ln -s /usr/local/etc/ slurm"
   - exec_chroot: mkdir /var/log/slurm
 - write_conf_files:
   - exec_current: cp -rp $$include_dir/etc/slurm/*  $$chroot/usr/local/etc/
 - init_dbd:
   - write_file:
     - /usr/local/sbin/grant_dbd.sql
     - |
       grant all on slurm_acct_db.* TO 'slurm'@'localhost' identified by 'slurm' with grant option;  
   #- exec_chroot: /etc/init.d/mysql start ; mysql -p'kameleon' < /usr/local/sbin/grant_dbd.sql ; /etc/init.d/mysql stop
#
#
#  - add_init_script_with_resources:
#    - write_file:
#      - /etc/init.d/slurm-server-conf
#      - |       
#        #! /bin/sh
#        # Default-Start:    5
#        # Default-Stop:     0 1 6
#        case \"\$1\" in
#          start)
#            mkdir /dev/cpuset
#            mount -t cpuset none /dev/cpuset 
#            /usr/local/bin/scontrol update NodeName=$$network_hostname State=IDLE
#            /usr/local/sbin/slurmctld
#            /usr/local/sbin/slurmd -N node1
#            /usr/local/sbin/slurmd -N node2
#            ;;
#          stop)
#            ;;
#          *)
#            exit 1
#            ;;
#        esac
#        exit 0
#    - exec_chroot: chmod +x /etc/init.d/slurm-server-conf
#    - exec_chroot: update-rc.d slurm-server-conf defaults
